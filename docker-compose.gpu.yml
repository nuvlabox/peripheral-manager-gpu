
version: "3.6"

x-common: &common
  stop_grace_period: 4s
  logging:
    options:
      max-size: "250k"
      max-file: "10"
  labels:
    - "nuvlabox.component=True"
    - "nuvlabox.deployment=production"
    - "nuvlabox.peripheral.component=True"
    - "nuvlabox.peripheral.type=usb"

services:
  peripheral-manager-gpu:
    <<: *common
    image: nuvladev/peripheral-manager-gpu:dev
    restart: on-failure
    network_mode: host
    environment:
      - NUVLABOX_UUID=${NUVLABOX_UUID}
      - NUVLA_ENDPOINT=${NUVLA_ENDPOINT:-nuvla.io}
      - NUVLA_ENDPOINT_INSECURE=${NUVLA_ENDPOINT_INSECURE:-False}
    volumes:
      - /etc:/etc:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - nuvlabox-db:/srv/nuvlabox/shared